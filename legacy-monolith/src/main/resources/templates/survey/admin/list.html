<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <title>ÏÑ§Î¨∏Ï°∞ÏÇ¨ Í¥ÄÎ¶¨</title>
</head>
<body>
<div layout:fragment="content">
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>üìä ÏÑ§Î¨∏Ï°∞ÏÇ¨ Í¥ÄÎ¶¨</h2>
            <a href="/survey/admin/create" class="btn btn-primary">
                <i class="fas fa-plus"></i> ÏÉà ÏÑ§Î¨∏ ÎßåÎì§Í∏∞
            </a>
        </div>

        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- ÏÑ§Î¨∏ Î™©Î°ù -->
        <div class="card">
            <div class="card-body">
                <div th:if="${surveys != null and !surveys.isEmpty()}">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Ï†úÎ™©</th>
                            <th>Í∏∞Í∞Ñ</th>
                            <th>ÏÉÅÌÉú</th>
                            <th>ÏùëÎãµ Ïàò</th>
                            <th>Í¥ÄÎ¶¨</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="survey : ${surveys.content}">
                            <td>
                                <strong th:text="${survey.title}"></strong>
                                <br>
                                <small class="text-muted" th:text="${survey.description}"></small>
                            </td>
                            <td>
                                <small th:text="${#temporals.format(survey.startDate, 'yyyy-MM-dd HH:mm')}"></small>
                                ~
                                <small th:text="${#temporals.format(survey.endDate, 'yyyy-MM-dd HH:mm')}"></small>
                            </td>
                            <td>
                                <span th:if="${survey.isOngoing}" class="badge bg-success">ÏßÑÌñâ Ï§ë</span>
                                <span th:if="${survey.isExpired}" class="badge bg-secondary">Ï¢ÖÎ£å</span>
                                <span th:if="${!survey.isOngoing and !survey.isExpired}" class="badge bg-warning">ÏòàÏ†ï</span>
                            </td>
                            <td>
                                <strong th:text="${survey.responseCount}"></strong> Í±¥
                            </td>
                            <td>
                                <a th:href="@{/survey/admin/{id}/statistics(id=${survey.surveyId})}" class="btn btn-sm btn-info">
                                    <i class="fas fa-chart-bar"></i> ÌÜµÍ≥Ñ
                                </a>
                                <a th:href="@{/survey/admin/{id}/edit(id=${survey.surveyId})}" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i> ÏàòÏ†ï
                                </a>
                                <button class="btn btn-sm btn-danger" th:onclick="'deleteSurvey(' + ${survey.surveyId} + ')'">
                                    <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- ÌéòÏù¥Ïßï -->
                    <nav th:if="${surveys.totalPages > 1}">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:classappend="${surveys.first} ? 'disabled'">
                                <a class="page-link" th:href="@{/survey/admin(page=${currentPage - 1})}">Ïù¥Ï†Ñ</a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, surveys.totalPages - 1)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link" th:href="@{/survey/admin(page=${i})}" th:text="${i + 1}"></a>
                            </li>
                            <li class="page-item" th:classappend="${surveys.last} ? 'disabled'">
                                <a class="page-link" th:href="@{/survey/admin(page=${currentPage + 1})}">Îã§Ïùå</a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div th:if="${surveys == null or surveys.isEmpty()}" class="text-center py-5">
                    <p class="text-muted">Îì±Î°ùÎêú ÏÑ§Î¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                    <a href="/survey/admin/create" class="btn btn-primary">Ï≤´ ÏÑ§Î¨∏ ÎßåÎì§Í∏∞</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        function deleteSurvey(surveyId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÏÑ§Î¨∏ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            fetch(`/api/surveys/${surveyId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert(data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
            });
        }
    </script>
</div>
</body>
</html>
