<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <title th:text="${isEdit} ? 'ν¬νΈν΄λ¦¬μ¤ μμ •' : 'ν¬νΈν΄λ¦¬μ¤ μƒμ„±'">ν¬νΈν΄λ¦¬μ¤</title>
    <style>
        .section-divider {
            border-top: 2px solid #e9ecef;
            margin: 2rem 0 1.5rem 0;
            padding-top: 1.5rem;
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 1rem;
        }
        .form-help {
            font-size: 0.875rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h3 th:text="${isEdit} ? 'ν¬νΈν΄λ¦¬μ¤ μμ •' : 'μƒ ν¬νΈν΄λ¦¬μ¤ λ§λ“¤κΈ°'">ν¬νΈν΄λ¦¬μ¤</h3>
                        <p class="mb-0 text-muted">λ‚λ§μ ν¬νΈν΄λ¦¬μ¤λ¥Ό μ‘μ„±ν•μ—¬ μ„±κ³Όμ™€ κ²½ν—μ„ μ²΄κ³„μ μΌλ΅ κ΄€λ¦¬ν•μ„Έμ”</p>
                    </div>
                    <div class="card-body">
                        <form id="portfolioForm">

                            <!-- κΈ°λ³Έ μ •λ³΄ -->
                            <div class="mb-4">
                                <h5 class="section-title">π“‹ κΈ°λ³Έ μ •λ³΄</h5>

                                <div class="mb-3">
                                    <label for="title" class="form-label">ν¬νΈν΄λ¦¬μ¤ μ λ© *</label>
                                    <input type="text" class="form-control" id="title" name="title"
                                           th:value="${portfolio?.title}" required maxlength="200"
                                           placeholder="μ: 2024 λ‚μ μ„±μ¥ ν¬νΈν΄λ¦¬μ¤">
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label">ν¬νΈν΄λ¦¬μ¤ μ„¤λ…</label>
                                    <textarea class="form-control" id="description" name="description"
                                              rows="3" maxlength="2000" th:text="${portfolio?.description}"
                                              placeholder="μ΄ ν¬νΈν΄λ¦¬μ¤μ— λ€ν• κ°„λ‹¨ν• μ„¤λ…μ„ μ‘μ„±ν•΄μ£Όμ„Έμ”"></textarea>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="visibility" class="form-label">κ³µκ° λ²”μ„</label>
                                        <select class="form-select" id="visibility" name="visibility">
                                            <option value="PRIVATE" th:selected="${portfolio == null or portfolio.visibility.name() == 'PRIVATE'}">λΉ„κ³µκ°</option>
                                            <option value="PUBLIC" th:selected="${portfolio?.visibility?.name() == 'PUBLIC'}">κ³µκ°</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="templateType" class="form-label">ν…ν”λ¦Ώ μ ν•</label>
                                        <select class="form-select" id="templateType" name="templateType">
                                            <option value="">κΈ°λ³Έ ν…ν”λ¦Ώ</option>
                                            <option value="PROFESSIONAL" th:selected="${portfolio?.templateType == 'PROFESSIONAL'}">ν”„λ΅νμ…”λ„</option>
                                            <option value="CREATIVE" th:selected="${portfolio?.templateType == 'CREATIVE'}">ν¬λ¦¬μ—μ΄ν‹°λΈ</option>
                                            <option value="ACADEMIC" th:selected="${portfolio?.templateType == 'ACADEMIC'}">ν•™μ ν•</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="profileImageUrl" class="form-label">ν”„λ΅ν•„ μ΄λ―Έμ§€ URL</label>
                                    <input type="url" class="form-control" id="profileImageUrl" name="profileImageUrl"
                                           th:value="${portfolio?.profileImageUrl}" maxlength="500"
                                           placeholder="https://example.com/profile.jpg">
                                    <div class="form-text">ν”„λ΅ν•„ μ‚¬μ§„μ URLμ„ μ…λ ¥ν•μ„Έμ” (μ„ νƒμ‚¬ν•­)</div>
                                </div>
                            </div>

                            <!-- μκΈ°μ†κ° -->
                            <div class="section-divider">
                                <h5 class="section-title">π‘¤ μκΈ°μ†κ°</h5>

                                <div class="mb-3">
                                    <label for="aboutMe" class="form-label">μκΈ°μ†κ°</label>
                                    <textarea class="form-control" id="aboutMe" name="aboutMe"
                                              rows="5" maxlength="5000" th:text="${portfolio?.aboutMe}"
                                              placeholder="μμ‹ μ„ μ†κ°ν•λ” κΈ€μ„ μ‘μ„±ν•΄μ£Όμ„Έμ”. κ²½ν—, κ°•μ , κ°€μΉκ΄€ λ“±μ„ ν¬ν•¨ν•  μ μμµλ‹λ‹¤."></textarea>
                                    <div class="form-text">μµλ€ 5000μ</div>
                                </div>

                                <div class="mb-3">
                                    <label for="careerGoal" class="form-label">κ²½λ ¥ λ©ν‘ / ν¬λ§ λ¶„μ•Ό</label>
                                    <input type="text" class="form-control" id="careerGoal" name="careerGoal"
                                           th:value="${portfolio?.careerGoal}" maxlength="500"
                                           placeholder="μ: λ°μ΄ν„° λ¶„μ„κ°€, AI κ°λ°μ">
                                    <div class="form-text">ν–¥ν›„ μ§„λ΅ λ©ν‘λ‚ κ΄€μ‹¬ λ¶„μ•Όλ¥Ό μ‘μ„±ν•΄μ£Όμ„Έμ”</div>
                                </div>
                            </div>

                            <!-- μ—°λ½μ² -->
                            <div class="section-divider">
                                <h5 class="section-title">π“ μ—°λ½μ²</h5>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="contactEmail" class="form-label">μ΄λ©”μΌ</label>
                                        <input type="email" class="form-control" id="contactEmail" name="contactEmail"
                                               th:value="${portfolio?.contactEmail}" maxlength="100"
                                               placeholder="your.email@example.com">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="contactPhone" class="form-label">μ „ν™”λ²νΈ</label>
                                        <input type="tel" class="form-control" id="contactPhone" name="contactPhone"
                                               th:value="${portfolio?.contactPhone}" maxlength="20"
                                               placeholder="010-1234-5678">
                                    </div>
                                </div>
                            </div>

                            <!-- SNS & λ§ν¬ -->
                            <div class="section-divider">
                                <h5 class="section-title">π”— SNS & λ§ν¬</h5>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="githubUrl" class="form-label">
                                            <i class="fab fa-github"></i> GitHub
                                        </label>
                                        <input type="url" class="form-control" id="githubUrl" name="githubUrl"
                                               th:value="${portfolio?.githubUrl}" maxlength="200"
                                               placeholder="https://github.com/username">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="blogUrl" class="form-label">
                                            <i class="fas fa-blog"></i> λΈ”λ΅κ·Έ
                                        </label>
                                        <input type="url" class="form-control" id="blogUrl" name="blogUrl"
                                               th:value="${portfolio?.blogUrl}" maxlength="200"
                                               placeholder="https://blog.example.com">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="linkedinUrl" class="form-label">
                                            <i class="fab fa-linkedin"></i> LinkedIn
                                        </label>
                                        <input type="url" class="form-control" id="linkedinUrl" name="linkedinUrl"
                                               th:value="${portfolio?.linkedinUrl}" maxlength="200"
                                               placeholder="https://linkedin.com/in/username">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="websiteUrl" class="form-label">
                                            <i class="fas fa-globe"></i> κ°μΈ μ›Ήμ‚¬μ΄νΈ
                                        </label>
                                        <input type="url" class="form-control" id="websiteUrl" name="websiteUrl"
                                               th:value="${portfolio?.websiteUrl}" maxlength="200"
                                               placeholder="https://mywebsite.com">
                                    </div>
                                </div>
                            </div>

                            <!-- μ—­λ‰ λ° κ΄€μ‹¬μ‚¬ -->
                            <div class="section-divider">
                                <h5 class="section-title">π’΅ μ—­λ‰ λ° κ΄€μ‹¬μ‚¬</h5>

                                <div class="mb-3">
                                    <label for="skills" class="form-label">κΈ°μ  μ¤νƒ / μ—­λ‰</label>
                                    <textarea class="form-control" id="skills" name="skills"
                                              rows="3" th:text="${portfolio?.skills}"
                                              placeholder="μ: Java, Python, Spring Boot, React, MySQL (μ‰Όν‘λ΅ κµ¬λ¶„)"></textarea>
                                    <div class="form-text">λ³΄μ ν• κΈ°μ μ΄λ‚ μ—­λ‰μ„ μ‰Όν‘λ΅ κµ¬λ¶„ν•μ—¬ μ…λ ¥ν•μ„Έμ”</div>
                                </div>

                                <div class="mb-3">
                                    <label for="interests" class="form-label">κ΄€μ‹¬ λ¶„μ•Ό</label>
                                    <textarea class="form-control" id="interests" name="interests"
                                              rows="3" th:text="${portfolio?.interests}"
                                              placeholder="μ: μΈκ³µμ§€λ¥, λ°μ΄ν„° λ¶„μ„, μ›Ή κ°λ°, UX/UI λ””μμΈ (μ‰Όν‘λ΅ κµ¬λ¶„)"></textarea>
                                    <div class="form-text">κ΄€μ‹¬μλ” λ¶„μ•Όλ‚ μ£Όμ λ¥Ό μ‰Όν‘λ΅ κµ¬λ¶„ν•μ—¬ μ…λ ¥ν•μ„Έμ”</div>
                                </div>
                            </div>

                            <!-- ν•™λ ¥ μ •λ³΄ -->
                            <div class="section-divider">
                                <h5 class="section-title">π“ ν•™λ ¥ μ •λ³΄</h5>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="major" class="form-label">μ „κ³µ</label>
                                        <input type="text" class="form-control" id="major" name="major"
                                               th:value="${portfolio?.major}" maxlength="100"
                                               placeholder="μ: μ»΄ν“¨ν„°κ³µν•™κ³Ό">
                                    </div>

                                    <div class="col-md-3 mb-3">
                                        <label for="grade" class="form-label">ν•™λ…„</label>
                                        <select class="form-select" id="grade" name="grade">
                                            <option value="">μ„ νƒ</option>
                                            <option value="1" th:selected="${portfolio?.grade == 1}">1ν•™λ…„</option>
                                            <option value="2" th:selected="${portfolio?.grade == 2}">2ν•™λ…„</option>
                                            <option value="3" th:selected="${portfolio?.grade == 3}">3ν•™λ…„</option>
                                            <option value="4" th:selected="${portfolio?.grade == 4}">4ν•™λ…„</option>
                                        </select>
                                    </div>

                                    <div class="col-md-3 mb-3">
                                        <label for="gpa" class="form-label">GPA</label>
                                        <input type="number" class="form-control" id="gpa" name="gpa"
                                               th:value="${portfolio?.gpa}" step="0.01" min="0" max="4.5"
                                               placeholder="4.5">
                                        <div class="form-text">0.00 ~ 4.50</div>
                                    </div>
                                </div>
                            </div>

                            <!-- λ²„νΌ -->
                            <div class="d-flex justify-content-between mt-4 pt-3" style="border-top: 2px solid #dee2e6;">
                                <a href="/portfolio" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> μ·¨μ†
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    <span th:text="${isEdit} ? 'μμ • μ™„λ£' : 'ν¬νΈν΄λ¦¬μ¤ μƒμ„±'">μƒμ„±</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        document.getElementById('portfolioForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // λ¨λ“  ν•„λ“ μμ§‘
            const formData = {
                // κΈ°λ³Έ μ •λ³΄
                title: document.getElementById('title').value,
                description: document.getElementById('description').value || null,
                visibility: document.getElementById('visibility').value,
                templateType: document.getElementById('templateType').value || null,
                profileImageUrl: document.getElementById('profileImageUrl').value || null,

                // μκΈ°μ†κ°
                aboutMe: document.getElementById('aboutMe').value || null,
                careerGoal: document.getElementById('careerGoal').value || null,

                // μ—°λ½μ²
                contactEmail: document.getElementById('contactEmail').value || null,
                contactPhone: document.getElementById('contactPhone').value || null,

                // SNS & λ§ν¬
                githubUrl: document.getElementById('githubUrl').value || null,
                blogUrl: document.getElementById('blogUrl').value || null,
                linkedinUrl: document.getElementById('linkedinUrl').value || null,
                websiteUrl: document.getElementById('websiteUrl').value || null,

                // μ—­λ‰ λ° κ΄€μ‹¬μ‚¬
                skills: document.getElementById('skills').value || null,
                interests: document.getElementById('interests').value || null,

                // ν•™λ ¥ μ •λ³΄
                major: document.getElementById('major').value || null,
                grade: document.getElementById('grade').value ? parseInt(document.getElementById('grade').value) : null,
                gpa: document.getElementById('gpa').value ? parseFloat(document.getElementById('gpa').value) : null
            };

            const isEdit = [[${isEdit}]] || false;
            const portfolioId = [[${portfolio?.portfolioId}]];
            const url = isEdit ? `/api/portfolios/${portfolioId}` : '/api/portfolios';
            const method = isEdit ? 'PUT' : 'POST';

            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    window.location.href = '/portfolio';
                } else {
                    alert(data.error || 'μ²λ¦¬ μ‹¤ν¨');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('μ²λ¦¬ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤');
            });
        });
    </script>
</div>
</body>
</html>
