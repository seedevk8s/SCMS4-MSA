# 이메일 설정 가이드

## 개요
SCMS 시스템은 회원가입 시 이메일 인증 기능을 제공합니다. 이를 위해 SMTP 서버 설정이 필요합니다.

## 문제 증상
다음과 같은 오류가 발생하는 경우:
```
jakarta.mail.AuthenticationFailedException: 535-5.7.8 Username and Password not accepted
```

이는 이메일 인증 정보가 올바르지 않거나 설정되지 않은 경우입니다.

## Gmail 사용 설정 (권장)

### 1. Google 계정 준비
Gmail을 SMTP 서버로 사용하려면 **앱 비밀번호**를 생성해야 합니다.

> **중요**: 일반 Gmail 비밀번호로는 SMTP 인증이 불가능합니다. 반드시 앱 비밀번호를 사용해야 합니다.

### 2. 2단계 인증 활성화
1. Google 계정 설정으로 이동: https://myaccount.google.com/
2. 좌측 메뉴에서 "보안" 클릭
3. "Google에 로그인" 섹션에서 "2단계 인증" 클릭
4. 안내에 따라 2단계 인증 설정 완료

### 3. 앱 비밀번호 생성
1. Google 계정 보안 페이지로 이동
2. "2단계 인증" 섹션 하단에서 "앱 비밀번호" 클릭
   - 또는 직접 이동: https://myaccount.google.com/apppasswords
3. "앱 선택"에서 "메일" 선택
4. "기기 선택"에서 "기타(맞춤 이름)" 선택
5. 이름 입력 (예: "SCMS 서버")
6. "생성" 클릭
7. **16자리 앱 비밀번호 복사** (예: `abcd efgh ijkl mnop`)
   - 이 비밀번호는 다시 볼 수 없으므로 안전한 곳에 보관하세요

### 4. 환경 변수 설정

#### 방법 1: .env 파일 사용 (개발 환경)

프로젝트 루트에 `.env` 파일 생성:
```bash
# Mail Configuration
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=abcdefghijklmnop
```

**주의사항:**
- `MAIL_PASSWORD`에는 생성한 16자리 앱 비밀번호를 입력 (공백 제거)
- `.env` 파일은 절대 Git에 커밋하지 마세요 (`.gitignore`에 포함되어 있음)

#### 방법 2: 시스템 환경 변수 사용 (운영 환경)

**Linux/Mac:**
```bash
export MAIL_USERNAME=your-email@gmail.com
export MAIL_PASSWORD=abcdefghijklmnop
```

영구 설정 (`.bashrc` 또는 `.zshrc`에 추가):
```bash
echo 'export MAIL_USERNAME=your-email@gmail.com' >> ~/.bashrc
echo 'export MAIL_PASSWORD=abcdefghijklmnop' >> ~/.bashrc
source ~/.bashrc
```

**Windows (PowerShell):**
```powershell
$env:MAIL_USERNAME = "your-email@gmail.com"
$env:MAIL_PASSWORD = "abcdefghijklmnop"
```

영구 설정:
```powershell
[System.Environment]::SetEnvironmentVariable('MAIL_USERNAME', 'your-email@gmail.com', 'User')
[System.Environment]::SetEnvironmentVariable('MAIL_PASSWORD', 'abcdefghijklmnop', 'User')
```

#### 방법 3: IntelliJ IDEA 실행 구성

1. IntelliJ에서 상단 실행 구성 선택 (Run/Debug Configurations)
2. "Environment variables" 필드 클릭
3. 다음 추가:
   ```
   MAIL_USERNAME=your-email@gmail.com;MAIL_PASSWORD=abcdefghijklmnop
   ```

### 5. 설정 확인

현재 설정된 메일 구성은 `src/main/resources/application.yml`에서 확인할 수 있습니다:

```yaml
spring:
  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:your-email@gmail.com}
    password: ${MAIL_PASSWORD:your-app-password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
```

### 6. 애플리케이션 재시작

환경 변수 설정 후 Spring Boot 애플리케이션을 재시작합니다:
```bash
./gradlew bootRun
```

## 다른 이메일 서비스 사용

### Naver 메일
```yaml
spring:
  mail:
    host: smtp.naver.com
    port: 465
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true
            trust: smtp.naver.com
```

### Daum 메일
```yaml
spring:
  mail:
    host: smtp.daum.net
    port: 465
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true
```

## 테스트

### 1. 회원가입 테스트
1. 애플리케이션 실행 후 외부 사용자 회원가입 페이지 접속
2. 이메일 주소 입력 후 가입 진행
3. 이메일함 확인하여 인증 메일 수신 확인

### 2. 로그 확인
```bash
# 성공 시
이메일 인증 메일 발송 완료: user@example.com

# 실패 시
이메일 인증 메일 발송 실패: user@example.com
jakarta.mail.AuthenticationFailedException: ...
```

## 문제 해결

### 인증 실패 (AuthenticationFailedException)
**원인:**
- 앱 비밀번호가 아닌 일반 비밀번호 사용
- 2단계 인증 미설정
- 잘못된 이메일 주소 또는 비밀번호

**해결:**
1. 2단계 인증 활성화 확인
2. 새로운 앱 비밀번호 생성
3. 환경 변수 재설정
4. 애플리케이션 재시작

### 연결 타임아웃
**원인:**
- 방화벽 설정
- 네트워크 문제

**해결:**
1. 포트 587 (TLS) 또는 465 (SSL) 방화벽 허용
2. 네트워크 연결 확인

### 메일이 발송되지 않음
**원인:**
- Gmail 발송 제한 (하루 500통)
- 스팸으로 분류

**해결:**
1. Gmail 발송 제한 확인
2. 수신자의 스팸 메일함 확인
3. 발신자 이메일 주소 신뢰도 향상

## 보안 권장사항

1. **환경 변수 사용**: 절대 코드에 직접 이메일 비밀번호 입력 금지
2. **.env 파일 보호**: `.gitignore`에 `.env` 포함 필수
3. **앱 비밀번호 관리**: 안전한 곳에 보관, 주기적 갱신
4. **접근 제한**: 운영 서버의 경우 환경 변수 접근 권한 제한
5. **HTTPS 사용**: 이메일 인증 링크는 항상 HTTPS 사용

## 참고 자료
- [Google 앱 비밀번호 도움말](https://support.google.com/accounts/answer/185833)
- [Spring Boot Mail 설정](https://docs.spring.io/spring-boot/docs/current/reference/html/messaging.html#messaging.email)
- [JavaMail API](https://javaee.github.io/javamail/)
